branch-protection:
  allow_disabled_policies: true  # TODO(fejta): remove, needed by k/website
  orgs:
    rawlingsj: 
      protect: true
      required_status_checks:
        contexts:
        - ci
        repos:
          spring-prow1:
            required_status_checks:
              strict: true
              contexts:
              - ci
          environment-dukepepper-production:
            required_status_checks:
              strict: true
              contexts:
              - promotion-gate
          environment-dukepepper-staging:
            required_status_checks:
              strict: true
              contexts:
              - promotion-gate

owners_dir_blacklist:
  default: null
  repos: null

pod_namespace: jx

presubmits:
  rawlingsj/spring-prow1:
  - agent: build
    branches:
        - master
    cluster: ""
    context: ci
    labels: null
    max_concurrency: 0
    name: ci
    rerun_command: /test this
    run_after_success: null
    run_if_changed: ""    
    skip_branches: null
    skip_report: false
    build_spec:
      steps:
      - image: rawlingsj/cwp-jenkinsfile-runner-demo:dev1
        trigger: (?m)^/test( all| this),?(\\s+|$)
    
  rawlingsj/environment-dukepepper-staging:
  - agent: kubernetes
    always_run: true
    branches: null
    cluster: ""
    context: promotion-gate
    labels: null
    max_concurrency: 0
    name: promotion-gate
    rerun_command: /test this
    run_after_success: null
    run_if_changed: ""
    skip_branches: null
    skip_report: false
    spec:
      containers:
      - args:
        - jx
        - step
        - helm
        - build
        env:
        - name: DEPLOY_NAMESPACE
          value: jx-staging
        - name: CHART_REPOSITORY
          value: http://jenkins-x-chartmuseum:8080
        - name: XDG_CONFIG_HOME
          value: /home/jenkins
        - name: GIT_COMMITTER_EMAIL
          value: jenkins-x@googlegroups.com
        - name: GIT_AUTHOR_EMAIL
          value: jenkins-x@googlegroups.com
        - name: GIT_AUTHOR_NAME
          value: jenkins-x-bot
        - name: GIT_COMMITTER_NAME
          value: jenkins-x-bot
        image: jenkinsxio/builder-base:latest
        name: ""
        resources: {}
      serviceAccountName: jenkins
    trigger: (?m)^/test( all| this),?(\s+|$)

  rawlingsj/environment-dukepepper-production:
  - agent: kubernetes
    always_run: true
    branches: null
    cluster: ""
    context: promotion-gate
    labels: null
    max_concurrency: 0
    name: promotion-gate
    rerun_command: /test this
    run_after_success: null
    run_if_changed: ""
    skip_branches: null
    skip_report: false
    spec:
      containers:
      - args:
        - jx
        - step
        - helm
        - build
        env:
        - name: DEPLOY_NAMESPACE
          value: jx-staging
        - name: CHART_REPOSITORY
          value: http://jenkins-x-chartmuseum:8080
        - name: XDG_CONFIG_HOME
          value: /home/jenkins
        - name: GIT_COMMITTER_EMAIL
          value: jenkins-x@googlegroups.com
        - name: GIT_AUTHOR_EMAIL
          value: jenkins-x@googlegroups.com
        - name: GIT_AUTHOR_NAME
          value: jenkins-x-bot
        - name: GIT_COMMITTER_NAME
          value: jenkins-x-bot
        image: jenkinsxio/builder-base:latest
        name: ""
        resources: {}
      serviceAccountName: jenkins
    trigger: (?m)^/test( all| this),?(\s+|$)

  postsubmits:
    rawlingsj/environment-dukepepper-staging:
    - agent: kubernetes
      branches: null
      cluster: ""
      labels: null
      max_concurrency: 0
      name: test-postsubmits
      run_after_success: null
      skip_branches: null
      spec:
        containers:
        - args:
          - jx
          - step
          - helm
          - apply
          env:
          - name: DEPLOY_NAMESPACE
            value: jx-staging
          - name: CHART_REPOSITORY
            value: http://jenkins-x-chartmuseum:8080
          - name: XDG_CONFIG_HOME
            value: /home/jenkins
          - name: GIT_COMMITTER_EMAIL
            value: jenkins-x@googlegroups.com
          - name: GIT_AUTHOR_EMAIL
            value: jenkins-x@googlegroups.com
          - name: GIT_AUTHOR_NAME
            value: jenkins-x-bot
          - name: GIT_COMMITTER_NAME
            value: jenkins-x-bot
          image: jenkinsxio/builder-base:latest
          name: ""
          resources: {}
        serviceAccountName: jenkins

    rawlingsj/environment-dukepepper-production:
    - agent: kubernetes
      branches: null
      cluster: ""
      labels: null
      max_concurrency: 0
      name: test-postsubmits
      run_after_success: null
      skip_branches: null
      spec:
        containers:
        - args:
          - jx
          - step
          - helm
          - apply
          env:
          - name: DEPLOY_NAMESPACE
            value: jx-staging
          - name: CHART_REPOSITORY
            value: http://jenkins-x-chartmuseum:8080
          - name: XDG_CONFIG_HOME
            value: /home/jenkins
          - name: GIT_COMMITTER_EMAIL
            value: jenkins-x@googlegroups.com
          - name: GIT_AUTHOR_EMAIL
            value: jenkins-x@googlegroups.com
          - name: GIT_AUTHOR_NAME
            value: jenkins-x-bot
          - name: GIT_COMMITTER_NAME
            value: jenkins-x-bot
          image: jenkinsxio/builder-base:latest
          name: ""
          resources: {}
        serviceAccountName: jenkins
push_gateway: {}

sinker:
  resync_period: 4m
  max_prowjob_age: 48h
  max_pod_age: 30m

tide:
  context_options:
    from-branch-protection: true
  skip-unknown-contexts:
    true
  queries:
  - labels:
    - approved
    missingLabels:
    - do-not-merge
    - do-not-merge/hold
    - do-not-merge/work-in-progress
    - needs-ok-to-test
    - needs-rebase
    repos:
    - rawlingsj/spring-prow1:
  target_url: https://tide.foo.bar

